# Docker講座 

## 0-1 このtechプレゼンの進め方
 - 40分のプレゼン<br>
 ・０章-イントロダクション <br>
 ・１章-概要説明<br>
 ・２章-実演しながら使いから紹介<br>
 ・３章-まとめ<br>


## 0-2 ゴール

この40分間のTechプレゼンで、次のことが理解できるようになります：

- Dockerが解決する課題
- Dockerの基本的な仕組みと構成要素
- 仮想マシンとの違い
- コンテナ技術がもたらす開発・運用へのインパクト
- 開発現場やチームでの活用イメージ
 - プレゼンの後にgithubの専用レポジトリの中のデータをつかって各々実践<br>
 ➡ **自宅サーバーに専用のVMを用意したので、興味がある人は実際のサーバーを使ってデプロイできます！**

---

## 1-1. そもそも「Docker」とは？

### ▶ 開発現場のあるある

- 「自分の環境では動いたんだけど…」
- 開発環境・本番環境の違いによる不具合
- セットアップに時間がかかる

### ▶ Dockerを一言で説明すると...

> **「アプリケーションとその動作環境を一つのパッケージ（コンテナ）として実行できる技術」**

---

## 1-2. Dockerが解決する問題

| 課題                           | Docker導入後                     |
|--------------------------------|----------------------------------|
| 環境差異によるバグ             | 同じイメージでどこでも動く      |
| 複雑な開発環境の構築           | Dockerfileで一発再現             |
| サーバー構成のドキュメント不足 | 実行環境がコードとして明示的     |
| テスト環境の準備が面倒         | テスト用コンテナで即起動        |

---

## 1-3. Dockerの中身：どうやって動く？

### 主な構成要素

- **イメージ（Image）**  
  アプリとその環境を一体化した"設計図"

- **コンテナ（Container）**  
  イメージを実行した実体。軽量な仮想環境。

- **Dockerfile**  
  イメージを自動で作るためのレシピ。

- **Docker Engine**  
  コンテナを動かす仕組みそのもの。

---

## 1-4. 仮想マシンとの違い

| 比較項目           | 仮想マシン (VM)           | Docker（コンテナ）       |
|--------------------|---------------------------|---------------------------|
| 起動時間           | 数十秒～数分               | 数秒                      |
| オーバーヘッド     | 高い（OSごと仮想化）       | 少ない（ホストOSを共用） |
| イメージサイズ     | GB単位が多い               | MB～数百MB                |
| 使用用途           | 完全な仮想環境が必要なとき | 軽量な環境分離が必要なとき|

➡ **Dockerは「速い・軽い・手軽」な仮想環境**

---

## 1-5. なぜ今Dockerなのか？

- **クラウド時代との相性◎**  
  → AWS, GCP, Azureなど各社が対応

- **CI/CDパイプラインでの活用**  
  → 開発→テスト→本番 すべてDockerで

- **インフラエンジニアだけでなく、全ての開発者に役立つ**

---

## 1-6. 現場での使われ方（イメージ）

- **開発環境の統一**：新しいメンバーも`docker-compose up`で即参入
- **マイクロサービス構築**：複数サービスをコンテナで管理
- **自動テスト環境の構築**：毎回クリーンな状態でテスト実行
- **スケーラブルな本番環境**：Kubernetesと連携して自動スケーリング

---

## 1-7. よくある誤解

- ❌ DockerはVMの代わり → 違います！より**軽量で目的が違う**
- ❌ Dockerを使えばセキュリティ万全 → セキュリティ設計は別途必要
- ❌ 難しそう → 基本操作だけなら**数コマンドで始められる**

---

## 1-8. 学んだことをどう活かす？

- 自分のアプリをDocker化してポートフォリオに
- チームで共通環境をDockerで構築・共有
- 今後の「Kubernetes」「CI/CD」「クラウド活用」にスムーズにつながる

---

## 1-9 概要まとめ

- Dockerはアプリ＋その環境をひとまとめにして動かす技術
- 軽量・高速・再現性が高く、現代の開発スタイルにマッチ
- 小規模でも導入メリットあり！まずは「触ってみる」ことが第一歩

---

# ２章Docker実演

## 🎯 実演の目的

- macOS上でNext.jsアプリをDocker化して起動
- DebianサーバーにDockerでデプロイ
- クライアントとサーバーの環境差を吸収できることを確認

---

## 2-1. 前提環境

### クライアント（macOS）

- Docker Desktop インストール済み
- VSCode推奨

### サーバー（Debian）

- Docker + Docker Compose インストール済み
- SSH接続できる状態

---

## 2-2. プロジェクト作成（macOS上）

```bash
npx create-next-app my-next-app
cd my-next-app

```


## 2-3. Dockerfileの作成

Next.jsアプリをDockerで動かすには、まず `Dockerfile` を用意します。

このファイルでは、アプリをどういう環境で、どんな手順でセットアップし、どのコマンドで起動するかを記述します。

以下がDockerfile

```Dockerfile
# Node.jsの軽量版イメージをベースにする（alpineは最小構成）
FROM node:18-alpine

# アプリケーションを配置するディレクトリを作成
WORKDIR /app

# パッケージ定義ファイルをコピー
COPY package*.json ./

# 依存関係をインストール
RUN npm install

# 残りのアプリケーションのコードを全てコピー
COPY . .

# アプリが使用するポート（Next.jsのデフォルトは3000）
EXPOSE 3000

# アプリを開発モードで起動
CMD ["npm", "run", "dev"]

```
## 2-4 dockerignoreの作成
.dockerignore ファイルは、Dockerに「コピーしなくていいファイル」を指示するためのファイルです。

特に開発中は node_modules や .next ディレクトリなど、イメージ内に不要な一時ファイルを除外してビルドを軽量に保ちます。


## 2-5. Dockerでビルド＆実行（ローカル：macOS）

作成したDockerfileを使って、ローカルでNext.jsアプリをDockerイメージにビルドし、実行します。

### イメージのビルド

```bash
docker build -t my-next-app .
```


コンテナの起動
``` bash
docker run -p 3000:3000 my-next-app
-p 3000:3000：ホストの3000番ポートを、コンテナの3000番ポートにマッピングします。
```
ブラウザで以下にアクセスして確認：
http://localhost:3000
## 2-6. Docker Composeの導入

Docker Composeを使うと、複数の設定（ビルド・ポート・ボリューム・環境変数など）をdocker-compose.ymlファイルで一括管理できる。

docker-compose.yml の作成

```docker-compose.yml
version: "3.8"

services:
  web:
    build: .
    ports:
      - "3000:3000"
    volumes:
      - .:/app
      - /app/node_modules
    environment:
      - NODE_ENV=development

```
docker-composeの起動
```bash
docker compose up
```
## 2-7 サーバー（Debian）へのデプロイ